<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>보이지 않는 물을 보라!</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- STAGE 1: 접근/경고 -->
  <section id="stage1" class="stage active" aria-label="접근 단계">
    <div class="panel warning">
      <div class="blink-dot" aria-hidden="true"></div>
      <div class="warning-title">WARNING</div>
      <div class="warning-msg">집중호우 시뮬레이션 가동</div>
      <div id="geoStatus" class="sub">위치 확인을 준비 중입니다…</div>

      <button id="startBtn" class="primary" type="button" disabled>
        스캐너 시작 (카메라/위치 허용)
      </button>

      <button id="bypassBtn" class="ghost" type="button">
        위치 확인이 안 되면(플랜B) 바로 시작
      </button>
    </div>

    <div class="footer-hint">
      전망데크/제방 근처에서 실행하면 효과가 좋습니다. (권한 허용 필요)
    </div>
  </section>

  <!-- STAGE 2: 카메라 + 시뮬레이션 -->
  <section id="stage2" class="stage" aria-label="시뮬레이션 단계">
    <video id="cam" playsinline muted autoplay></video>

    <canvas id="rain"></canvas>

    <div id="water">
      <div id="waterText" class="water-text">수위 상승… 산책로 침수 위험!</div>
    </div>

    <div class="hud" role="status" aria-live="polite">
      <div class="hud-title">[시뮬레이션] 시간당 100mm 폭우</div>
      <div id="timer" class="hud-sub">00:00</div>
    </div>
  </section>

  <!-- STAGE 3: 시스템 진단 결과 -->
  <div id="diagnosis" class="modal" role="dialog" aria-modal="true" aria-label="시스템 진단 결과">
    <div class="modal-card">
      <div class="shieldBig" aria-hidden="true">🛡️</div>
      <div class="modal-title">[시스템 진단 결과]</div>

      <div class="modal-body">
        <div class="row"><span class="k">상황</span><span class="v">시간당 100mm 기록적 폭우 발생!</span></div>
        <div class="row"><span class="k">운정호수 상태</span><span class="v">빗물 <b id="retentionText">약 30만 톤</b> 저류 성공! (스펀지 모드 작동 중)</span></div>
        <div class="row"><span class="k">결과</span><span class="v">주변 아파트 및 도로 침수 방어 완료. <b>안전합니다.</b></span></div>
      </div>

      <button id="quizBtn" class="primary" type="button">퀴즈하기 (복불복 1문항)</button>
      <button id="closeDiagnosisBtn" class="ghost" type="button">닫기</button>
    </div>
  </div>

  <!-- QUIZ -->
  <div id="quiz" class="modal" role="dialog" aria-modal="true" aria-label="퀴즈">
    <div class="modal-card">
      <div class="modal-title">그린인프라 퀴즈</div>

      <div class="pill">오늘의 문제는 랜덤입니다. (보기 순서도 랜덤)</div>

      <form id="quizForm">
        <div class="modal-body">
          <div id="qTitle" class="q-title">문제 로딩 중…</div>
          <div id="options"></div>
          <div id="quizFeedback" class="feedback" aria-live="polite"></div>
        </div>

        <button id="submitQuizBtn" class="primary" type="submit">제출</button>
        <button id="closeQuizBtn" class="ghost" type="button">닫기</button>
      </form>
    </div>
  </div>

  <!-- REWARD -->
  <div id="reward" class="modal" role="dialog" aria-modal="true" aria-label="방패 획득">
    <div class="modal-card reward-card">
      <div class="rewardShield" aria-hidden="true">🛡️</div>
      <div class="modal-title">방패 획득!</div>
      <div id="rewardMsg" class="modal-body">
        잘했어요. 그린인프라는 빗물을 천천히 모으고 스며들게 합니다.
      </div>
      <button id="rewardOkBtn" class="primary" type="button">확인</button>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
